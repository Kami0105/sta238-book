<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Error | STA238: Probability, Statistics, and Data Analysis</title>
  <meta name="description" content="This book represents part of the course materials for STA238 at the University of Toronto" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Error | STA238: Probability, Statistics, and Data Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book represents part of the course materials for STA238 at the University of Toronto" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Error | STA238: Probability, Statistics, and Data Analysis" />
  
  <meta name="twitter:description" content="This book represents part of the course materials for STA238 at the University of Toronto" />
  

<meta name="author" content="Alison Gibbs and Alex Stringer" />


<meta name="date" content="2019-09-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="statistics-and-plots.html"/>
<link rel="next" href="mathematical-models.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">STA238 University of Toronto</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html"><i class="fa fa-check"></i><b>2</b> Statistics and Plots</a><ul>
<li class="chapter" data-level="2.1" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#descriptive-analysis"><i class="fa fa-check"></i><b>2.2</b> Descriptive analysis</a><ul>
<li class="chapter" data-level="2.2.1" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#exercises"><i class="fa fa-check"></i><b>2.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#exploratory-analysis"><i class="fa fa-check"></i><b>2.3</b> Exploratory analysis</a><ul>
<li class="chapter" data-level="2.3.1" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#exercises-1"><i class="fa fa-check"></i><b>2.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#prescriptive-analysis"><i class="fa fa-check"></i><b>2.4</b> Prescriptive analysis</a><ul>
<li class="chapter" data-level="2.4.1" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#exercises-2"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#rental-housing-in-toronto"><i class="fa fa-check"></i><b>2.5</b> Rental housing in Toronto</a><ul>
<li class="chapter" data-level="2.5.1" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#load-the-data"><i class="fa fa-check"></i><b>2.5.1</b> Load the data</a></li>
<li class="chapter" data-level="2.5.2" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#analysis-i-what-does-the-data-look-like"><i class="fa fa-check"></i><b>2.5.2</b> Analysis I: what does the data look like?</a></li>
<li class="chapter" data-level="2.5.3" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#analysis-ii-do-different-wards-have-different-quality-housing"><i class="fa fa-check"></i><b>2.5.3</b> Analysis II: Do different wards have different quality housing?</a></li>
<li class="chapter" data-level="2.5.4" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#analysis-iii-trends-in-quality-over-time"><i class="fa fa-check"></i><b>2.5.4</b> Analysis III: trends in quality over time</a></li>
<li class="chapter" data-level="2.5.5" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#summary"><i class="fa fa-check"></i><b>2.5.5</b> Summary</a></li>
<li class="chapter" data-level="2.5.6" data-path="statistics-and-plots.html"><a href="statistics-and-plots.html#exercises-3"><i class="fa fa-check"></i><b>2.5.6</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="error.html"><a href="error.html"><i class="fa fa-check"></i><b>3</b> Error</a><ul>
<li class="chapter" data-level="3.1" data-path="error.html"><a href="error.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="error.html"><a href="error.html#statistical-error-under-repeated-sampling"><i class="fa fa-check"></i><b>3.2</b> Statistical error under repeated sampling</a><ul>
<li class="chapter" data-level="3.2.1" data-path="error.html"><a href="error.html#the-idea"><i class="fa fa-check"></i><b>3.2.1</b> The idea</a></li>
<li class="chapter" data-level="3.2.2" data-path="error.html"><a href="error.html#example-coin-flipping"><i class="fa fa-check"></i><b>3.2.2</b> Example: coin flipping</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="error.html"><a href="error.html#case-study-which-wards-have-the-highestlowest-quality-rental-housing"><i class="fa fa-check"></i><b>3.3</b> Case study: which wards have the highest/lowest quality rental housing?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mathematical-models.html"><a href="mathematical-models.html"><i class="fa fa-check"></i><b>4</b> Mathematical Models</a></li>
<li class="chapter" data-level="5" data-path="computational-models.html"><a href="computational-models.html"><i class="fa fa-check"></i><b>5</b> Computational Models</a></li>
<li class="chapter" data-level="6" data-path="incorporating-what-i-know-using-prior-information-to-inform-inferences.html"><a href="incorporating-what-i-know-using-prior-information-to-inform-inferences.html"><i class="fa fa-check"></i><b>6</b> Incorporating what I know: using prior information to inform inferences</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STA238: Probability, Statistics, and Data Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="error" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Error</h1>
<div id="introduction-2" class="section level2">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<p>In this chapter we will more formally discuss the notion of <strong>error</strong>. We will learn how to identify potential sources of error in an analysis, and for certain types of error, how to <em>quantify</em> them.</p>
<p>There are many different potential sources of error when analyzing data. A very limited list of examples:</p>
<ul>
<li><p><strong>Human error</strong>. You may make a mistake somewhere in your code. You could join tables incorrectly, exclude/include data you didn’t mean to, compute a summary or fit a model incorrectly.</p></li>
<li><p><strong>Statistical error</strong>. The data you have is subject to <em>uncertainty</em> and <em>variability</em>. In a survey or scientific experiment, your data may be subject to <em>sampling variability</em>, which is the notion that if you repeated your data collection again under identical circumstances, you’d get different data. In cases where such hypothetical <em>repeated sampling</em> doesn’t make sense—for example when studying phenomena like air pollution or temperature, which occur once at each given place and time—your data is still not perfectly measured and you may be <em>uncertain</em> that it is fully capturing the underlying truth.</p></li>
<li><p><strong>Communication error</strong>. You might have perfect data and a perfect analysis, and then communicate the results incorrectly. Or, your analysis and data might not be answering the question you intended.</p></li>
</ul>
<p>In this chapter we will primarily focus on <strong>statistical error</strong>, because this is the type of error that, in statistical sciences, we are usually able to <em>quantify</em>.</p>
</div>
<div id="statistical-error-under-repeated-sampling" class="section level2">
<h2><span class="header-section-number">3.2</span> Statistical error under repeated sampling</h2>
<div id="the-idea" class="section level3">
<h3><span class="header-section-number">3.2.1</span> The idea</h3>
<p>Data is often collected as a <em>random sample</em> from some population of interest. If you perform a scientific
experiment in a lab, you don’t measure every rat who has ever lived or ever will live; if you take a
survey of Ontario residents to gauge political opinions, you don’t ask <em>everybody</em>.</p>
<p>When data is collected as a random sample, it is subject to <strong>variability</strong>.
Each datapoint collected is different than the one before it, and
the one after it. Variability is a physical property of the universe. If I grow a plant with the
intention of measuring its height, there isn’t some predetermined height that it will be,
with certainty. And if I measure the height of one plant, I don’t automatically know the
height of the next plant. And so on.</p>
<p>When we compute summaries of our data—<strong>statistics</strong>—we are <em>not</em> saying that the value
we compute from our data is exactly the truth. We hope that the summaries we compute are
<em>useful representations</em> of the truth, which is a fancy way of saying we hope they are not
too far off. But we understand that <strong>if we collected another sample, we’d get different values</strong>
of these summaries.</p>
<p>How do we know whether the summaries we compute are useful representations of the truth?
We have to be sure we mitigate <strong>human error</strong> and <strong>communication error</strong> through our
analysis. But they will still be subject to <strong>statistical error</strong>, because our data is a sample.</p>
<p>The goal then becomes to mitigate—reduce as much as is reasonable, given the context—the
statistical error in our summaries. In order to figure out how to do this, it is fundamental
that we are able to <strong>quantify the statistical error</strong> in our summaries.</p>
</div>
<div id="example-coin-flipping" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Example: coin flipping</h3>
<p>Let’s start with a simple example. Suppose I am interested in whether a coin in my hand
is “fair” or not. Specifically, I want to know: when I flip the coin, what is the
probability <span class="math inline">\(p\)</span> that it comes up heads? The probability that it comes up tails is
then <span class="math inline">\(1 - p\)</span>. The problem is: I don’t know anything about this coin. All I can do is flip it.</p>
<p>(Note: in a few chapters, I’ll argue that in fact I <em>do</em> know <em>something</em> about this
coin, and I can use this to inform my analysis. We’ll build up to that though.)</p>
<p>How can I make an educated guess at the value of <span class="math inline">\(p\)</span>? All I can do is flip the coin.
Flipping the coin will give me <strong>data</strong>, and I can summarize these data in a manner
which gives me insight into the underlying <em>random process</em> which generated the data.
Since <span class="math inline">\(p\)</span> represents the probability of the coin coming up heads, it seems logical
that I should use the <strong>sample proportion of heads</strong>—the number of heads divided
by the number of flips—for my educated guess at what <span class="math inline">\(p\)</span> is.</p>
<p>Let’s try this. First write a function to flip the coin once, then a function to
flip the coin <span class="math inline">\(n\)</span> times. Then write a function to compute the sample proportion
of heads as a result of flipping the coin <span class="math inline">\(n\)</span> times.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1"><span class="co"># Function to flip the coin once, and return 1 if heads and 0 if tails.</span></a>
<a class="sourceLine" id="cb54-2" title="2"><span class="co"># To simulate a random variable which takes on values of 1 with probability</span></a>
<a class="sourceLine" id="cb54-3" title="3"><span class="co"># 1/2 and 0 with probability 1/2, I will simulate a U ~ Unif(0,1) random variable,</span></a>
<a class="sourceLine" id="cb54-4" title="4"><span class="co"># and then return an indicator of whether U &gt; 1/2, which happens with probability</span></a>
<a class="sourceLine" id="cb54-5" title="5"><span class="co"># 1/2.</span></a>
<a class="sourceLine" id="cb54-6" title="6">flip_the_coin_once &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb54-7" title="7">  <span class="co"># This function takes no arguments.</span></a>
<a class="sourceLine" id="cb54-8" title="8">  <span class="co"># It uses random number generation to return 1 with probability 1/2</span></a>
<a class="sourceLine" id="cb54-9" title="9">  <span class="co"># and 0 with probability 1/2</span></a>
<a class="sourceLine" id="cb54-10" title="10">  <span class="kw">as.numeric</span>(<span class="kw">runif</span>(<span class="dv">1</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb54-11" title="11">}</a>
<a class="sourceLine" id="cb54-12" title="12"></a>
<a class="sourceLine" id="cb54-13" title="13"><span class="co"># Function to flip the coin n times and return a vector containing</span></a>
<a class="sourceLine" id="cb54-14" title="14"><span class="co"># the results of each flip</span></a>
<a class="sourceLine" id="cb54-15" title="15">flip_the_coin_more_than_once &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb54-16" title="16">  <span class="co"># n: number of times to flip the coin.</span></a>
<a class="sourceLine" id="cb54-17" title="17">  <span class="co"># Returns a vector of length n containing the results of each flip.</span></a>
<a class="sourceLine" id="cb54-18" title="18">  out &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)</a>
<a class="sourceLine" id="cb54-19" title="19">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb54-20" title="20">    out[i] &lt;-<span class="st"> </span><span class="kw">flip_the_coin_once</span>()</a>
<a class="sourceLine" id="cb54-21" title="21">  }</a>
<a class="sourceLine" id="cb54-22" title="22">  out</a>
<a class="sourceLine" id="cb54-23" title="23">}</a>
<a class="sourceLine" id="cb54-24" title="24"></a>
<a class="sourceLine" id="cb54-25" title="25"><span class="co"># Function to flip the coin n times and compute the</span></a>
<a class="sourceLine" id="cb54-26" title="26"><span class="co"># sample proportion of heads</span></a>
<a class="sourceLine" id="cb54-27" title="27">sample_proportion_of_heads &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb54-28" title="28">  <span class="co"># n: number of times to flip the coin</span></a>
<a class="sourceLine" id="cb54-29" title="29">  <span class="co"># Returns a number representing the sample proportion of heads</span></a>
<a class="sourceLine" id="cb54-30" title="30">  <span class="co"># in n flips</span></a>
<a class="sourceLine" id="cb54-31" title="31">  <span class="kw">mean</span>(<span class="kw">flip_the_coin_more_than_once</span>(n))</a>
<a class="sourceLine" id="cb54-32" title="32">}</a></code></pre></div>
<p>Okay, let’s try it out. I’ll flip the coin, I don’t know, 10 times, and we’ll
see what kind of a value we get for <span class="math inline">\(p\)</span>. Note that in this example, we know that
the <em>true</em> value of <span class="math inline">\(p\)</span> is <span class="math inline">\(p = 0.5\)</span>. We can use this to actually assess how
accurate our experiment is or isn’t. In “the wild”, when analyzing data, we don’t
know this, and can’t fully assess the accuracy of our procedure.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1"><span class="kw">set.seed</span>(<span class="dv">4178032</span>) <span class="co"># Pick some arbitrary number. Gives the same random numbers every time.</span></a>
<a class="sourceLine" id="cb55-2" title="2"><span class="co"># I do this for reproducibility, because this is a book.</span></a>
<a class="sourceLine" id="cb55-3" title="3"><span class="kw">sample_proportion_of_heads</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 0.2</code></pre>
<p>We conclude that <span class="math inline">\(p = 0.2\)</span>.</p>
<p>What happened?</p>
<p>Our procedure didn’t give a very sensible summary. Given that we know that <span class="math inline">\(p = 0.5\)</span>,
knowing that, were this a real experiment, we would have concluded that there was
a <span class="math inline">\(20\%\)</span> chance of heads, is not very encouraging.</p>
<p>The key idea to remember is that <em>if we repeated this experiment again, we would get
different data and hence a different estimate</em>. Actually, let’s just do it:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="kw">set.seed</span>(<span class="dv">469096</span>)</a>
<a class="sourceLine" id="cb57-2" title="2"><span class="kw">sample_proportion_of_heads</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 0.8</code></pre>
<p>That’s certainly different, though just as bad. Let’s try again:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1"><span class="kw">set.seed</span>(<span class="dv">80798</span>)</a>
<a class="sourceLine" id="cb59-2" title="2"><span class="kw">sample_proportion_of_heads</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 0.5</code></pre>
<p>So it does work, sometimes.</p>
<p>Can we get a better idea of what types of values this procedure returns, <em>on average</em>?
And <em>with high probability</em>? Let’s try to visualize this. We’ll perform our coin-flipping
experiment many times, and then plot a histogram of the resulting sample proportions:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1"><span class="kw">set.seed</span>(<span class="dv">41679</span>)</a>
<a class="sourceLine" id="cb61-2" title="2">N &lt;-<span class="st"> </span><span class="dv">10000</span> <span class="co"># Number of times to repeat the experiment</span></a>
<a class="sourceLine" id="cb61-3" title="3">sample_proportions &lt;-<span class="st"> </span><span class="kw">numeric</span>(N) <span class="co"># Vector to store the results</span></a>
<a class="sourceLine" id="cb61-4" title="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N) sample_proportions[i] &lt;-<span class="st"> </span><span class="kw">sample_proportion_of_heads</span>(<span class="dv">10</span>) <span class="co"># Perform the experiments</span></a>
<a class="sourceLine" id="cb61-5" title="5"></a>
<a class="sourceLine" id="cb61-6" title="6"><span class="co"># Plot them</span></a>
<a class="sourceLine" id="cb61-7" title="7"><span class="kw">tibble</span>(<span class="dt">x =</span> sample_proportions) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb61-8" title="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-9" title="9"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb61-10" title="10"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..count..<span class="op">/</span><span class="kw">sum</span>(..count..)),<span class="dt">bins =</span> <span class="dv">50</span>,<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="dt">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-11" title="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> stringr<span class="op">::</span><span class="kw">str_c</span>(<span class="st">&quot;Sample proportions from 10 coin flips, repeated &quot;</span>,scales<span class="op">::</span><span class="kw">comma</span>(N),<span class="st">&quot; times.&quot;</span>),</a>
<a class="sourceLine" id="cb61-12" title="12">       <span class="dt">x =</span> <span class="st">&quot;Proportion of heads&quot;</span>,</a>
<a class="sourceLine" id="cb61-13" title="13">       <span class="dt">y =</span> <span class="st">&quot;Proportion of experiments which had that proportion of heads&quot;</span></a>
<a class="sourceLine" id="cb61-14" title="14">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-15" title="15"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span>.<span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-16" title="16"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">percent_format</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-17" title="17"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">.495</span>,<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>,<span class="dt">linetype =</span> <span class="st">&quot;dotdash&quot;</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/coin-plot-1-1.png" width="672" /></p>
<p>I notice a few things:</p>
<ol style="list-style-type: decimal">
<li><p>Only 10 values are actually possible. In particular, if we don’t get
<span class="math inline">\(p = 0.5\)</span>, the closest we can come is <span class="math inline">\(p = 0.4\)</span> or <span class="math inline">\(p = 0.6\)</span>, which aren’t that close.</p></li>
<li><p>While <span class="math inline">\(p = 0.5\)</span> occurs <em>most often</em>, values between <span class="math inline">\(0.3\)</span> and <span class="math inline">\(0.7\)</span> occur very frequently.</p></li>
<li><p>We see, in a very small number of cases, values of <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>, which make no sense
(we can look at a coin and see that it has no sides).</p></li>
</ol>
<p>While point <span class="math inline">\(\# 3\)</span> will take some more background to address, points <span class="math inline">\(\# 1\)</span> and <span class="math inline">\(\# 2\)</span> can
be mitigated in a simple way: flip the coin more times.</p>
<p>Let’s see how the number of flips affects the distribution of sample proportions:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" title="1"><span class="kw">set.seed</span>(<span class="dv">45856</span>)</a>
<a class="sourceLine" id="cb62-2" title="2">N &lt;-<span class="st"> </span><span class="dv">10000</span> <span class="co"># Number of times to repeat the experiment</span></a>
<a class="sourceLine" id="cb62-3" title="3">n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">1000</span>) <span class="co"># Numbers of times to flip the coin</span></a>
<a class="sourceLine" id="cb62-4" title="4">sample_proportions &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb62-5" title="5">  <span class="dt">n =</span> <span class="kw">rep</span>(n,N),</a>
<a class="sourceLine" id="cb62-6" title="6">  <span class="dt">p =</span> <span class="kw">numeric</span>(<span class="kw">length</span>(n))</a>
<a class="sourceLine" id="cb62-7" title="7">) <span class="co"># Dataframe to store the results</span></a>
<a class="sourceLine" id="cb62-8" title="8"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(sample_proportions)) {</a>
<a class="sourceLine" id="cb62-9" title="9">  sample_proportions[i,<span class="st">&quot;p&quot;</span>] &lt;-<span class="st"> </span><span class="kw">sample_proportion_of_heads</span>(</a>
<a class="sourceLine" id="cb62-10" title="10">    <span class="kw">as.numeric</span>(</a>
<a class="sourceLine" id="cb62-11" title="11">      sample_proportions[i,<span class="st">&quot;n&quot;</span>]</a>
<a class="sourceLine" id="cb62-12" title="12">      )</a>
<a class="sourceLine" id="cb62-13" title="13">    )</a>
<a class="sourceLine" id="cb62-14" title="14">}</a>
<a class="sourceLine" id="cb62-15" title="15"></a>
<a class="sourceLine" id="cb62-16" title="16"><span class="co"># Plot them</span></a>
<a class="sourceLine" id="cb62-17" title="17">plotlst &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb62-18" title="18"><span class="cf">for</span> (size <span class="cf">in</span> n) {</a>
<a class="sourceLine" id="cb62-19" title="19">  plotlst[[<span class="kw">as.character</span>(size)]] &lt;-<span class="st"> </span>sample_proportions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb62-20" title="20"><span class="st">    </span><span class="kw">filter</span>(n <span class="op">==</span><span class="st"> </span>size) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb62-21" title="21"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> p)) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-22" title="22"><span class="st">    </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb62-23" title="23"><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..count..<span class="op">/</span><span class="kw">sum</span>(..count..)),<span class="dt">bins =</span> <span class="dv">50</span>,<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="dt">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-24" title="24"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> stringr<span class="op">::</span><span class="kw">str_c</span>(scales<span class="op">::</span><span class="kw">comma</span>(size),<span class="st">&quot; flips&quot;</span>),<span class="dt">x =</span> <span class="st">&quot; &quot;</span>,<span class="dt">y =</span> <span class="st">&quot; &quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-25" title="25"><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span>.<span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-26" title="26"><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">percent_format</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-27" title="27"><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">.495</span>,<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>,<span class="dt">linetype =</span> <span class="st">&quot;dotdash&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-28" title="28"><span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb62-29" title="29">}</a>
<a class="sourceLine" id="cb62-30" title="30"></a>
<a class="sourceLine" id="cb62-31" title="31">cowplot<span class="op">::</span><span class="kw">plot_grid</span>(<span class="dt">plotlist =</span> plotlst,<span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/coin-plot-2-1.png" width="672" /></p>
<p>Woah!</p>
</div>
</div>
<div id="case-study-which-wards-have-the-highestlowest-quality-rental-housing" class="section level2">
<h2><span class="header-section-number">3.3</span> Case study: which wards have the highest/lowest quality rental housing?</h2>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1"><span class="kw">library</span>(tmap) <span class="co"># For maps!</span></a>
<a class="sourceLine" id="cb63-2" title="2"><span class="co"># Read in the pre-cleaned apartment data with postal codes</span></a>
<a class="sourceLine" id="cb63-3" title="3">apartmentpostal &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./data/apartment-data/apartment-postal-merged.rds&quot;</span>)</a>
<a class="sourceLine" id="cb63-4" title="4"><span class="co"># Render it as an appropriate spatial datatype</span></a>
<a class="sourceLine" id="cb63-5" title="5">apartmentpoints &lt;-<span class="st"> </span><span class="kw">SpatialPointsDataFrame</span>(</a>
<a class="sourceLine" id="cb63-6" title="6">  <span class="dt">coords =</span> apartmentpostal[ ,<span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>,<span class="st">&quot;lat&quot;</span>)],</a>
<a class="sourceLine" id="cb63-7" title="7">  <span class="dt">data =</span> apartmentpostal,</a>
<a class="sourceLine" id="cb63-8" title="8">  <span class="dt">proj4string =</span> <span class="kw">CRS</span>(<span class="kw">proj4string</span>(torontoct))</a>
<a class="sourceLine" id="cb63-9" title="9">)</a></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1"><span class="kw">library</span>(tmap) <span class="co"># Better map plotting software.</span></a>
<a class="sourceLine" id="cb64-2" title="2"><span class="co"># Load the shape file.</span></a>
<a class="sourceLine" id="cb64-3" title="3"><span class="co"># This is a spatial data format that tells us where to draw polygons</span></a>
<a class="sourceLine" id="cb64-4" title="4"><span class="co"># You don&#39;t have to know about it for this course (won&#39;t be tested).</span></a>
<a class="sourceLine" id="cb64-5" title="5">canadashape &lt;-<span class="st"> </span>rgdal<span class="op">::</span><span class="kw">readOGR</span>( <span class="co"># FSA- 3 digit postal code</span></a>
<a class="sourceLine" id="cb64-6" title="6">  <span class="st">&quot;/Users/alexstringer/teaching/w20/STA238/materials/book/data/shape-files/canada-fsa/gfsa000a11a_e.shp&quot;</span></a>
<a class="sourceLine" id="cb64-7" title="7">)</a></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/alexstringer/teaching/w20/STA238/materials/book/data/shape-files/canada-fsa/gfsa000a11a_e.shp&quot;, layer: &quot;gfsa000a11a_e&quot;
## with 1621 features
## It has 3 fields</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1">canadact &lt;-<span class="st"> </span>rgdal<span class="op">::</span><span class="kw">readOGR</span>( <span class="co"># Census tracts</span></a>
<a class="sourceLine" id="cb66-2" title="2">  <span class="st">&quot;/Users/alexstringer/teaching/w20/STA238/materials/book/data/shape-files/canada-ct/gct_000b11a_e.shp&quot;</span></a>
<a class="sourceLine" id="cb66-3" title="3">)</a></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/alexstringer/teaching/w20/STA238/materials/book/data/shape-files/canada-ct/gct_000b11a_e.shp&quot;, layer: &quot;gct_000b11a_e&quot;
## with 5452 features
## It has 8 fields</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1">canadada &lt;-<span class="st"> </span>rgdal<span class="op">::</span><span class="kw">readOGR</span>( <span class="co"># Dissemination areas</span></a>
<a class="sourceLine" id="cb68-2" title="2">  <span class="st">&quot;/Users/alexstringer/teaching/w20/STA238/materials/book/data/shape-files/canada-da/gda_000b11a_e.shp&quot;</span></a>
<a class="sourceLine" id="cb68-3" title="3">)</a></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/alexstringer/teaching/w20/STA238/materials/book/data/shape-files/canada-da/gda_000b11a_e.shp&quot;, layer: &quot;gda_000b11a_e&quot;
## with 56204 features
## It has 21 fields</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1"><span class="co"># Filter out only toronto postals.</span></a>
<a class="sourceLine" id="cb70-2" title="2"><span class="co"># Can&#39;t use the filter() function on a spatial dataframe.</span></a>
<a class="sourceLine" id="cb70-3" title="3"><span class="co"># Subset manually. Use a &#39;regular expression&#39;, common knowledge among CS folks</span></a>
<a class="sourceLine" id="cb70-4" title="4"><span class="co"># but maybe not so much among statisticians?</span></a>
<a class="sourceLine" id="cb70-5" title="5"><span class="co"># Toronto postals start with &quot;M&quot;. &quot;^[A-Z]&quot; is a regular expression which </span></a>
<a class="sourceLine" id="cb70-6" title="6"><span class="co"># matches any string that starts with &quot;M&quot;.</span></a>
<a class="sourceLine" id="cb70-7" title="7">torontoshape &lt;-<span class="st"> </span><span class="kw">subset</span>(canadashape,</a>
<a class="sourceLine" id="cb70-8" title="8">                stringr<span class="op">::</span><span class="kw">str_extract</span>(canadashape<span class="op">@</span>data<span class="op">$</span>CFSAUID,<span class="st">&quot;^[A-Z]&quot;</span>) <span class="op">==</span><span class="st"> &quot;M&quot;</span>)</a>
<a class="sourceLine" id="cb70-9" title="9"></a>
<a class="sourceLine" id="cb70-10" title="10">torontoct &lt;-<span class="st"> </span><span class="kw">subset</span>(canadact,</a>
<a class="sourceLine" id="cb70-11" title="11">                    stringr<span class="op">::</span><span class="kw">str_detect</span>(canadact<span class="op">@</span>data<span class="op">$</span>CMANAME,<span class="st">&quot;Toronto&quot;</span>))</a>
<a class="sourceLine" id="cb70-12" title="12"></a>
<a class="sourceLine" id="cb70-13" title="13">torontoda &lt;-<span class="st"> </span><span class="kw">subset</span>(canadada,</a>
<a class="sourceLine" id="cb70-14" title="14">                    stringr<span class="op">::</span><span class="kw">str_detect</span>(canadada<span class="op">@</span>data<span class="op">$</span>CDNAME,<span class="st">&quot;Toronto&quot;</span>))</a>
<a class="sourceLine" id="cb70-15" title="15"></a>
<a class="sourceLine" id="cb70-16" title="16"><span class="co"># Summarize the apartment scores by FSA (first 3 digits of postal).</span></a>
<a class="sourceLine" id="cb70-17" title="17"><span class="co"># Another clever (?) use of regular expressions.</span></a>
<a class="sourceLine" id="cb70-18" title="18">apartmentsummaryfsa &lt;-<span class="st"> </span>apartmentpostal <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb70-19" title="19"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fsa =</span> stringr<span class="op">::</span><span class="kw">str_extract</span>(postal,<span class="st">&quot;M[0-9][A-Z]&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Extracts the first three digits of the postal of the form MNX where N is a number and X is any letter.</span></a>
<a class="sourceLine" id="cb70-20" title="20"><span class="st">  </span><span class="kw">group_by</span>(fsa) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb70-21" title="21"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">score =</span> <span class="kw">mean</span>(score),<span class="dt">numapartments =</span> <span class="kw">n</span>())</a>
<a class="sourceLine" id="cb70-22" title="22"></a>
<a class="sourceLine" id="cb70-23" title="23"><span class="kw">glimpse</span>(apartmentsummaryfsa)</a></code></pre></div>
<pre><code>## Observations: 95
## Variables: 3
## $ fsa           &lt;chr&gt; NA, &quot;M1B&quot;, &quot;M1C&quot;, &quot;M1E&quot;, &quot;M1G&quot;, &quot;M1H&quot;, &quot;M1J&quot;, &quot;M1K…
## $ score         &lt;dbl&gt; 72.50000, 74.29167, 74.00000, 70.71875, 70.64286, …
## $ numapartments &lt;int&gt; 12, 24, 1, 32, 28, 15, 37, 78, 44, 17, 53, 36, 43,…</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1"><span class="co"># How big are the FSA&#39;s?</span></a>
<a class="sourceLine" id="cb72-2" title="2">apartmentsummaryfsa <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb72-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> numapartments)) <span class="op">+</span></a>
<a class="sourceLine" id="cb72-4" title="4"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb72-5" title="5"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>,<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="dt">fill =</span> <span class="st">&quot;lightgrey&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb72-6" title="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Number of rental buildings in each FSA&quot;</span>,</a>
<a class="sourceLine" id="cb72-7" title="7">       <span class="dt">x =</span> <span class="st">&quot;Number of buildings&quot;</span>,</a>
<a class="sourceLine" id="cb72-8" title="8">       <span class="dt">y =</span> <span class="st">&quot;Number of FSAs with that many buildings&quot;</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/make-map-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1"><span class="co"># What does the distribution of average score in an FSA look like?</span></a>
<a class="sourceLine" id="cb73-2" title="2">apartmentsummaryfsa <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb73-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> score)) <span class="op">+</span></a>
<a class="sourceLine" id="cb73-4" title="4"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb73-5" title="5"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>,<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="dt">fill =</span> <span class="st">&quot;lightgrey&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb73-6" title="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Average score in each FSA&quot;</span>,</a>
<a class="sourceLine" id="cb73-7" title="7">       <span class="dt">x =</span> <span class="st">&quot;Average score&quot;</span>,</a>
<a class="sourceLine" id="cb73-8" title="8">       <span class="dt">y =</span> <span class="st">&quot;Number of FSAs with that average score&quot;</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/make-map-2-2.png" width="672" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1"><span class="co"># Map of toronto coloured by average score</span></a>
<a class="sourceLine" id="cb74-2" title="2"><span class="co"># Merge the shape data with the apartment data</span></a>
<a class="sourceLine" id="cb74-3" title="3">toronto_apartments_avgscore &lt;-<span class="st"> </span>sp<span class="op">::</span><span class="kw">merge</span>(</a>
<a class="sourceLine" id="cb74-4" title="4">  torontoshape,</a>
<a class="sourceLine" id="cb74-5" title="5">  apartmentsummaryfsa,</a>
<a class="sourceLine" id="cb74-6" title="6">  <span class="dt">by.x =</span> <span class="st">&quot;CFSAUID&quot;</span>,</a>
<a class="sourceLine" id="cb74-7" title="7">  <span class="dt">by.y =</span> <span class="st">&quot;fsa&quot;</span></a>
<a class="sourceLine" id="cb74-8" title="8">)</a>
<a class="sourceLine" id="cb74-9" title="9"></a>
<a class="sourceLine" id="cb74-10" title="10"><span class="kw">tmap_mode</span>(<span class="st">&quot;plot&quot;</span>)</a></code></pre></div>
<pre><code>## tmap mode set to plotting</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1"><span class="kw">tm_shape</span>(toronto_apartments_avgscore) <span class="op">+</span></a>
<a class="sourceLine" id="cb76-2" title="2"><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&quot;score&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb76-3" title="3"><span class="st">  </span><span class="kw">tm_shape</span>(apartmentpoints) <span class="op">+</span></a>
<a class="sourceLine" id="cb76-4" title="4"><span class="st">  </span><span class="kw">tm_dots</span>()</a></code></pre></div>
<p><img src="book_files/figure-html/make-map-2-3.png" width="672" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1"><span class="kw">library</span>(sp)</a>
<a class="sourceLine" id="cb77-2" title="2"><span class="co"># Summary by Census Tract</span></a>
<a class="sourceLine" id="cb77-3" title="3"><span class="co"># Find out which CT each apartment building is in</span></a>
<a class="sourceLine" id="cb77-4" title="4">torontoapartmentsct &lt;-<span class="st"> </span>sp<span class="op">::</span><span class="kw">over</span>(apartmentpoints,torontoct)</a>
<a class="sourceLine" id="cb77-5" title="5"><span class="co"># Add it back on to the apartments data</span></a>
<a class="sourceLine" id="cb77-6" title="6">apartmentpostal_withct &lt;-<span class="st"> </span>apartmentpostal</a>
<a class="sourceLine" id="cb77-7" title="7">apartmentpostal_withct<span class="op">$</span>ct &lt;-<span class="st"> </span>torontoapartmentsct<span class="op">$</span>CTUID</a>
<a class="sourceLine" id="cb77-8" title="8"></a>
<a class="sourceLine" id="cb77-9" title="9">apartmentsummaryct &lt;-<span class="st"> </span>apartmentpostal_withct <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-10" title="10"><span class="st">  </span><span class="kw">group_by</span>(ct) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-11" title="11"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">score =</span> <span class="kw">mean</span>(score),<span class="dt">numapartments =</span> <span class="kw">n</span>())</a>
<a class="sourceLine" id="cb77-12" title="12"></a>
<a class="sourceLine" id="cb77-13" title="13"><span class="co"># How big are the Census Tracts?</span></a>
<a class="sourceLine" id="cb77-14" title="14">apartmentsummaryct <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-15" title="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> numapartments)) <span class="op">+</span></a>
<a class="sourceLine" id="cb77-16" title="16"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb77-17" title="17"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>,<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="dt">fill =</span> <span class="st">&quot;lightgrey&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb77-18" title="18"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Number of rental buildings in each CT&quot;</span>,</a>
<a class="sourceLine" id="cb77-19" title="19">       <span class="dt">x =</span> <span class="st">&quot;Number of buildings&quot;</span>,</a>
<a class="sourceLine" id="cb77-20" title="20">       <span class="dt">y =</span> <span class="st">&quot;Number of CTs with that many buildings&quot;</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/map-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1"><span class="co"># What does the distribution of average score in an FSA look like?</span></a>
<a class="sourceLine" id="cb78-2" title="2">apartmentsummaryct <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> score)) <span class="op">+</span></a>
<a class="sourceLine" id="cb78-4" title="4"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb78-5" title="5"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>,<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="dt">fill =</span> <span class="st">&quot;lightgrey&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb78-6" title="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Average score in each CT&quot;</span>,</a>
<a class="sourceLine" id="cb78-7" title="7">       <span class="dt">x =</span> <span class="st">&quot;Average score&quot;</span>,</a>
<a class="sourceLine" id="cb78-8" title="8">       <span class="dt">y =</span> <span class="st">&quot;Number of CTs with that average score&quot;</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/map-3-2.png" width="672" /></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1">toronto_apartments_avgscore_ct &lt;-<span class="st"> </span>sp<span class="op">::</span><span class="kw">merge</span>(</a>
<a class="sourceLine" id="cb79-2" title="2">  torontoct,</a>
<a class="sourceLine" id="cb79-3" title="3">  apartmentsummaryct,</a>
<a class="sourceLine" id="cb79-4" title="4">  <span class="dt">by.x =</span> <span class="st">&quot;CTUID&quot;</span>,</a>
<a class="sourceLine" id="cb79-5" title="5">  <span class="dt">by.y =</span> <span class="st">&quot;ct&quot;</span></a>
<a class="sourceLine" id="cb79-6" title="6">)</a>
<a class="sourceLine" id="cb79-7" title="7"></a>
<a class="sourceLine" id="cb79-8" title="8">toronto_apartments_avgscore_ct<span class="op">@</span>bbox &lt;-<span class="st"> </span>toronto_apartments_avgscore<span class="op">@</span>bbox</a>
<a class="sourceLine" id="cb79-9" title="9"></a>
<a class="sourceLine" id="cb79-10" title="10"><span class="kw">tmap_mode</span>(<span class="st">&quot;plot&quot;</span>)</a></code></pre></div>
<pre><code>## tmap mode set to plotting</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1"><span class="kw">tm_shape</span>(toronto_apartments_avgscore_ct) <span class="op">+</span></a>
<a class="sourceLine" id="cb81-2" title="2"><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&quot;score&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb81-3" title="3"><span class="st">  </span><span class="kw">tm_shape</span>(apartmentpoints) <span class="op">+</span></a>
<a class="sourceLine" id="cb81-4" title="4"><span class="st">  </span><span class="kw">tm_dots</span>()</a></code></pre></div>
<p><img src="book_files/figure-html/map-3-3.png" width="672" /></p>
<p>The reason the map has grey is because I filtered based on the Toronto “Census Metropolitan Area” (CMA), which includes the suburbs (a bunch of “L” postal codes). When you replicate this for the Dissemination Areas, you won’t have this grey, because they use the Toronto “Census Division”, which is what we commonly think of as being “Toronto”. Census data is confusing!</p>
<p>Exercise: reproduce the following analysis.</p>
<p><img src="book_files/figure-html/map-4-1.png" width="672" /><img src="book_files/figure-html/map-4-2.png" width="672" /></p>
<pre><code>## tmap mode set to plotting</code></pre>
<p><img src="book_files/figure-html/map-4-3.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistics-and-plots.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mathematical-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["book.pdf", "book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
